@startuml

actor Читатель
actor Библиотекарь
participant Библиотека
participant Каталог
participant Шкаф
participant Полка
participant Ячейка
participant Книга
participant Задолженность

Читатель -> Библиотекарь : Запрос на получение книги requestBookIssue(userID, book_id)
Библиотекарь -> Библиотека : Поиск книги searchBook(book_id) (прецедент)
alt Книга доступна
    Библиотека --> Библиотекарь : Книга найдена (доступна)
    Библиотекарь -> Библиотека : Проверка задолженностей checkUserDebts(userID)
    Библиотека -> Задолженность : getDebt(userID)
    alt Нет задолженностей
        Задолженность --> Библиотека : Долгов нет
        Библиотека -> Книга : updateBookStatus(book_id, "выдана")
        Библиотекарь -> Библиотека : Зафиксировать информацию о выдаче fixIssue(userID, date_issue, return_period)
        Библиотекарь -> Читатель : Передать книгу giveBook(book_id)
        Библиотекарь --> Библиотека : Получение книги завершено
    else Есть задолженности
        Задолженность --> Библиотека : Есть задолженность
        Библиотека -> Библиотека : Заблокировать выдачу blockIssue(userID)
        Библиотекарь -> Читатель : Сообщить о задолженностях reportDebt()
        Библиотекарь -> Читатель : Предложить погасить задолженность offerDebtRepay()
    end
else Книга недоступна
    Библиотека --> Библиотекарь : Книга недоступна
    Библиотекарь -> Читатель : Сообщить о недоступности книги reportBookUnavailable()
    Библиотекарь -> Читатель : Предложить альтернативы offerAlternatives()
    Читатель -> Библиотекарь : Выбрать альтернативу chooseAlternative(alternative_number)
end

@enduml
