@startuml

actor Пользователь
actor Библиотекарь
participant Система

Пользователь -> Библиотекарь : Передает книгу для возврата giveBookToReturn(book_id)
Библиотекарь -> Библиотекарь : Проверяет состояние книги checkBookСondition()
alt Книга без повреждений
    Библиотекарь -> Система : Обновить статус книги на "доступна" updateBookStatus(book_id, "доступна")
    Система --> Библиотекарь : Статус обновлен
    Библиотекарь -> Система : Проверить сроки возврата checkReturnDate(book_id, user_id)
    alt Книга возвращена вовремя
        Система --> Библиотекарь : Возврат вовремя
    else Книга возвращена с просрочкой
        Система --> Библиотекарь : Обнаружена просрочка
        Библиотекарь -> Пользователь : Сообщает о просрочке reportOverdue()
        Библиотекарь -> Система : Рассчитать штраф за просрочку calculateOverdueFine(days_overdue)
        Система --> Библиотекарь : Размер штрафа fine_amount
        Библиотекарь -> Пользователь : Информирует о штрафе reportFine(fine_amount)
        Библиотекарь -> Система : Добавить штраф в задолженность пользователя addFineToUser(user_id, fine_amount)
    end
else Книга повреждена
    Библиотекарь -> Пользователь : Сообщает о повреждениях reportDamage()
    Библиотекарь -> Система : Рассчитать стоимость повреждений calculateDamageFine(book_id)
    Система --> Библиотекарь : Стоимость повреждений damage_fine
    Библиотекарь -> Пользователь : Информирует о штрафе reportDamageFine(fine_amount)
    Библиотекарь -> Система : Обновить статус книги на "повреждена" updateBookStatus(book_id, "повреждена")
    Библиотекарь -> Система : Добавить штраф в задолженность пользователя addFineToUser(user_id, damage_fine)
end


@enduml
